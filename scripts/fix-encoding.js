/**
 * 修复 products.ejs 文件的编码问题
 */

const fs = require('fs');
const path = require('path');

const filePath = path.join(__dirname, '../views/products.ejs');

// 读取文件
let content = fs.readFileSync(filePath, 'utf-8');

// 修复乱码字符
const replacements = [
  // HTML 中的乱码
  [/管理系�?/g, '管理系统'],
  [/侧边�?/g, '侧边栏'],
  [/退出登�?/g, '退出登录'],
  [/顶部导航�?/g, '顶部导航栏'],
  [/欢迎�?/g, '欢迎，'],
  [/搜索和筛�?/g, '搜索和筛选'],
  [/所有分�?/g, '所有分类'],
  [/动态加�?/g, '动态加载'],
  [/销�?/g, '销量'],
  [/状�?/g, '状态'],
  [/�?/g, ''],
  [/记录，�?/g, '记录，共'],
  [/分页按钮将通过JS动态生�?/g, '分页按钮将通过JS动态生成'],
  [/图标URL或点击上�?/g, '图标URL或点击上传'],
  [/激�?/g, '激活'],
  [/热�?/g, '热门'],
  [/�?/g, '是'],
  [/�?/g, '否'],
  [/商品状�?/g, '商品状态'],
  [/设置�?/g, '设置'],
  [/规格类型标签�?/g, '规格类型标签页'],
  [/无描�?/g, '无描述'],

  // JS 注释中的乱码
  [/初始化页�?/g, '初始化页面'],
  [/填充分类选择�?/g, '填充分类选择器'],
  [/确保price是数字类�?/g, '确保price是数字类型'],
  [/上一页按�?/g, '上一页按钮'],
  [/下一页按�?/g, '下一页按钮'],
  [/重置筛选条�?/g, '重置筛选条件'],
  [/重置单选按�?/g, '重置单选按钮'],
  [/设置单选按�?/g, '设置单选按钮'],
  [/设置配料开�?/g, '设置配料开关'],
  [/设置各杯型启用开�?/g, '设置各杯型启用开关'],
  [/检查文件类�?/g, '检查文件类型'],
  [/只允许上�?/g, '只允许上传'],
  [/类型的图�?/g, '类型的图片'],
  [/检查文件大小（5MB�?/g, '检查文件大小（5MB）'],
  [/显示上传状�?/g, '显示上传状态'],
  [/上传�?\.\./g, '上传中...'],
  [/设置图�?/g, '设置图片'],
  [/上传失败�?/g, '上传失败：'],
  [/获取认证�?/g, '获取认证头'],
  [/分类保存成功�?/g, '分类保存成功！'],
  [/保存失败�?/g, '保存失败：'],
  [/删除后该分类下的商品将无法正常显示�?/g, '删除后该分类下的商品将无法正常显示。'],
  [/添加认证�?/g, '添加认证头'],
  [/分类删除成功�?/g, '分类删除成功！'],
  [/删除失败�?/g, '删除失败：'],
  [/删除失败：该分类下存在商品，请先将商品转移到其他分类或删除商品后再尝试删除分�?/g, '删除失败：该分类下存在商品，请先将商品转移到其他分类或删除商品后再尝试删除分类。'],
  [/冰度和甜度默认启�?/g, '冰度和甜度默认启用'],
  [/商品保存成功�?/g, '商品保存成功！'],
  [/渲染当前规格（杯型已移除，不在规格管理中�?/g, '渲染当前规格（杯型已移除，不在规格管理中）'],
  [/渲染规格�?/g, '渲染规格项'],
  [/添加规格�?/g, '添加规格项'],
  [/移除规格�?/g, '移除规格项'],
  [/合并所有规�?/g, '合并所有规格'],
  [/规格保存成功�?/g, '规格保存成功！'],
  [/商品删除成功�?/g, '商品删除成功！'],
];

let fixedCount = 0;
replacements.forEach(([pattern, replacement]) => {
  const matches = content.match(pattern);
  if (matches) {
    fixedCount += matches.length;
    content = content.replace(pattern, replacement);
  }
});

// 写回文件
fs.writeFileSync(filePath, content, 'utf-8');

console.log(`修复完成！共修复 ${fixedCount} 处乱码。`);
